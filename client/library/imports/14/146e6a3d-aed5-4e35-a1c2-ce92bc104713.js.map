{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\home\\prefab/assets\\script\\home\\prefab\\saleFrame.js"],"names":["cc","Class","extends","Component","properties","bg","default","type","Node","tooltip","slide","Slider","itemSprite","Sprite","itemAtlas","SpriteAtlas","nameLab","Label","numLab","gainLab","id","Integer","maxNum","onLoad","global","FitHelper","onEnable","node","on","init","start","onSlide","data","itemData","items","config","configConf","string","oldSize","width","spriteFrame","getSpriteFrame","newSize","scale","updateGain","parseInt","event","num","Math","round","progress","onPlusClick","target","onMinusClick","onSubmitClick","param","userData","token","HttpHelper","httpPost","urlConf","item_sale","rsp","code","clientAttrData","initClientAttrData","clientAttr","update","item","systemEvent","emit","gold","destroy","onCloseClick"],"mappings":";;;;;;AAAA;;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,YAAG;AACCC,qBAAS,IADV;AAECC,kBAAMP,GAAGQ,IAFV;AAGCC,qBAAS;AAHV,SADK;AAMRC,eAAM;AACFJ,qBAAS,IADP;AAEFC,kBAAMP,GAAGW,MAFP;AAGFF,qBAAS;AAHP,SANE;AAWRG,oBAAW;AACPN,qBAAS,IADF;AAEPC,kBAAMP,GAAGa,MAFF;AAGPJ,qBAAS;AAHF,SAXH;AAgBRK,mBAAU;AACNR,qBAAS,IADH;AAENC,kBAAMP,GAAGe,WAFH;AAGNN,qBAAS;AAHH,SAhBF;AAqBRO,iBAAQ;AACJV,qBAAS,IADL;AAEJC,kBAAMP,GAAGiB,KAFL;AAGJR,qBAAS;AAHL,SArBA;AA0BRS,gBAAO;AACHZ,qBAAS,IADN;AAEHC,kBAAMP,GAAGiB,KAFN;AAGHR,qBAAS;AAHN,SA1BC;AA+BRU,iBAAQ;AACJb,qBAAS,IADL;AAEJC,kBAAMP,GAAGiB,KAFL;AAGJR,qBAAS;AAHL,SA/BA;AAoCRW,YAAG;AACCd,qBAAS,CADV;AAECC,kBAAMP,GAAGqB,OAFV;AAGCZ,qBAAS;AAHV,SApCK;AAyCRa,gBAAO;AACHhB,qBAAS,CADN;AAEHC,kBAAMP,GAAGqB,OAFN;AAGHZ,qBAAS;AAHN;AAzCC,KAHP;;AAmDL;;AAEAc,UArDK,oBAqDK;AACNC,yBAAOC,SAAP,CAAiBC,QAAjB,CAA0B,KAAKrB,EAA/B;AACA,aAAKsB,IAAL,CAAUC,EAAV,CAAa,MAAb,EAAoB,KAAKC,IAAzB,EAA8B,IAA9B;AACH,KAxDI;AA0DLC,SA1DK,mBA0DI;AACL,YAAG,KAAKpB,KAAL,IAAc,IAAjB,EAAsB;AAClB;AACH;;AAED,aAAKA,KAAL,CAAWiB,IAAX,CAAgBC,EAAhB,CAAmB,OAAnB,EAA4B,KAAKG,OAAjC,EAA0C,IAA1C;AACH,KAhEI;AAkELF,QAlEK,gBAkEAG,IAlEA,EAmEL;AACI,YAAIA,OAAOR,iBAAOS,QAAP,CAAgBC,KAAhB,CAAsBF,KAAK,IAAL,CAAtB,CAAX;AACA,YAAIG,SAASX,iBAAOY,UAAP,CAAkB,MAAlB,EAA0BJ,KAAK,SAAL,CAA1B,CAAb;AACA,aAAKV,MAAL,GAAcU,KAAK,KAAL,CAAd;AACA,aAAKZ,EAAL,GAAUY,KAAK,IAAL,CAAV;AACA,aAAKd,MAAL,CAAYmB,MAAZ,GAAqB,KAAKf,MAA1B;AACA,aAAKN,OAAL,CAAaqB,MAAb,GAAsBF,OAAO,MAAP,CAAtB;AACA,YAAIG,UAAU,KAAK1B,UAAL,CAAgBe,IAAhB,CAAqBY,KAAnC;AACA,aAAK3B,UAAL,CAAgB4B,WAAhB,GAA8B,KAAK1B,SAAL,CAAe2B,cAAf,CAA8BN,OAAO,OAAP,CAA9B,CAA9B;AACA,YAAIO,UAAU,KAAK9B,UAAL,CAAgBe,IAAhB,CAAqBY,KAAnC;AACA,aAAK3B,UAAL,CAAgBe,IAAhB,CAAqBgB,KAArB,GAA6BL,UAAQI,OAArC;AACA,aAAKE,UAAL,CAAgBC,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,CAAhB;AACH,KA/EI;AAiFLN,WAjFK,mBAiFGe,KAjFH,EAiFS;AACV,YAAIC,MAAMC,KAAKC,KAAL,CAAW,KAAKvC,KAAL,CAAWwC,QAAX,GAAoB,KAAK5B,MAApC,CAAV;AACA,aAAKJ,MAAL,CAAYmB,MAAZ,GAAqBU,GAArB;AACA,aAAKrC,KAAL,CAAWwC,QAAX,GAAsBH,MAAI,KAAKzB,MAA/B;AACA,aAAKsB,UAAL,CAAgBG,GAAhB;AACH,KAtFI;AAwFLI,eAxFK,uBAwFOC,MAxFP,EAwFcpB,IAxFd,EAyFL;AACI,aAAKd,MAAL,CAAYmB,MAAZ,GAAsBQ,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,IAA+B,KAAKf,MAArC,GAA8CuB,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,IAA6B,CAA3E,GAA8E,KAAKf,MAAxG;AACA,aAAKZ,KAAL,CAAWwC,QAAX,GAAsBL,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,IAA6B,KAAKf,MAAxD;AACA,aAAKsB,UAAL,CAAgBC,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,CAAhB;AACH,KA7FI;AA+FLgB,gBA/FK,wBA+FQD,MA/FR,EA+FepB,IA/Ff,EAgGL;AACI,aAAKd,MAAL,CAAYmB,MAAZ,GAAsBQ,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,IAA+B,CAAhC,GAAoCQ,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,IAA6B,CAAjE,GAAoE,CAAzF;AACA,aAAK3B,KAAL,CAAWwC,QAAX,GAAsBL,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,IAA6B,KAAKf,MAAxD;AACA,aAAKsB,UAAL,CAAgBC,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,CAAhB;AACH,KApGI;AAsGLO,cAtGK,sBAsGMG,GAtGN,EAuGL;AACI,YAAIf,OAAOR,iBAAOS,QAAP,CAAgBC,KAAhB,CAAsB,KAAKd,EAA3B,CAAX;AACA,YAAIe,SAASX,iBAAOY,UAAP,CAAkB,MAAlB,EAA0BJ,KAAK,SAAL,CAA1B,CAAb;AACA,aAAKb,OAAL,CAAakB,MAAb,GAAsB,MAAMU,MAAIF,SAASV,OAAO,MAAP,CAAT,CAAhC;AACH,KA3GI;AA6GLmB,iBA7GK,yBA6GSF,MA7GT,EA6GgBpB,IA7GhB,EA6GqB;AAAA;;AACtB,YAAGa,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,KAAgC,CAAnC,EACI;;AAEJ,YAAIkB,QAAQ,EAAC,MAAK,KAAKnC,EAAX,EAAc,OAAMyB,SAAS,KAAK3B,MAAL,CAAYmB,MAArB,CAApB,EAAiD,UAASb,iBAAOgC,QAAP,CAAgBpC,EAA1E,EAA6E,SAAQI,iBAAOgC,QAAP,CAAgBC,KAArG,EAAZ;AACAjC,yBAAOkC,UAAP,CAAkBC,QAAlB,CAA2BnC,iBAAOoC,OAAP,CAAeC,SAA1C,EAAoDN,KAApD,EAA0D,UAACO,GAAD,EAAO;AAC7D,gBAAGA,OAAO,CAAC,CAAX,EACA;AACI;AACH;;AAED,gBAAGA,IAAIC,IAAJ,IAAY,GAAf,EACA;AACIvC,iCAAOwC,cAAP,CAAsBC,kBAAtB,CAAyCH,IAAI9B,IAAJ,CAASkC,UAAlD;AACA1C,iCAAOS,QAAP,CAAgBkC,MAAhB,CAAuB,CAACL,IAAI9B,IAAJ,CAASoC,IAAV,CAAvB;AACApE,mBAAGqE,WAAH,CAAeC,IAAf,CAAoB,aAApB,EAAkCR,IAAI9B,IAAJ,CAASoC,IAA3C;AACApE,mBAAGqE,WAAH,CAAeC,IAAf,CAAoB,kBAApB,EAAuCR,IAAI9B,IAAJ,CAASuC,IAAhD;AACA,sBAAK5C,IAAL,CAAU6C,OAAV;AACH,aAPD,MASA;AACI;AACH;AACJ,SAlBD;AAoBH,KAtII;AAwILC,gBAxIK,wBAwIQrB,MAxIR,EAwIepB,IAxIf,EAyIL;AACI,aAAKL,IAAL,CAAU6C,OAAV;AACH;;AAED;;AA7IK,CAAT","file":"saleFrame.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\home\\prefab","sourcesContent":["import global from './../../global/global';\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bg:{\r\n            default: null,\r\n            type: cc.Node,\r\n            tooltip: '背景'\r\n        },\r\n        slide:{\r\n            default: null,\r\n            type: cc.Slider,\r\n            tooltip: '滑动条'\r\n        },\r\n        itemSprite:{\r\n            default: null,\r\n            type: cc.Sprite,\r\n            tooltip: '图标'\r\n        },\r\n        itemAtlas:{\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n            tooltip: '道具plist'\r\n        },\r\n        nameLab:{\r\n            default: null,\r\n            type: cc.Label,\r\n            tooltip: '名字'\r\n        },\r\n        numLab:{\r\n            default: null,\r\n            type: cc.Label,\r\n            tooltip: '数量'\r\n        },\r\n        gainLab:{\r\n            default: null,\r\n            type: cc.Label,\r\n            tooltip: '收益'\r\n        },\r\n        id:{\r\n            default: 0,\r\n            type: cc.Integer,\r\n            tooltip: 'id'\r\n        },\r\n        maxNum:{\r\n            default: 0,\r\n            type: cc.Integer,\r\n            tooltip: '最大数量'\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        global.FitHelper.onEnable(this.bg);\r\n        this.node.on('init',this.init,this);\r\n    },\r\n\r\n    start () {\r\n        if(this.slide == null){\r\n            return;\r\n        }\r\n\r\n        this.slide.node.on('slide', this.onSlide, this);\r\n    },\r\n\r\n    init(data)\r\n    {\r\n        var data = global.itemData.items[data['id']];\r\n        var config = global.configConf['item'][data['item_id']];\r\n        this.maxNum = data['num'];\r\n        this.id = data['id'];\r\n        this.numLab.string = this.maxNum;\r\n        this.nameLab.string = config['name'];\r\n        var oldSize = this.itemSprite.node.width;\r\n        this.itemSprite.spriteFrame = this.itemAtlas.getSpriteFrame(config['image']);\r\n        var newSize = this.itemSprite.node.width;\r\n        this.itemSprite.node.scale = oldSize/newSize;\r\n        this.updateGain(parseInt(this.numLab.string));\r\n    },\r\n\r\n    onSlide(event){\r\n        var num = Math.round(this.slide.progress*this.maxNum);\r\n        this.numLab.string = num;\r\n        this.slide.progress = num/this.maxNum;\r\n        this.updateGain(num)\r\n    },\r\n\r\n    onPlusClick(target,data)\r\n    {\r\n        this.numLab.string = (parseInt(this.numLab.string) < this.maxNum)?(parseInt(this.numLab.string)+1):this.maxNum;\r\n        this.slide.progress = parseInt(this.numLab.string)/this.maxNum;\r\n        this.updateGain(parseInt(this.numLab.string));\r\n    },\r\n\r\n    onMinusClick(target,data)\r\n    {\r\n        this.numLab.string = (parseInt(this.numLab.string) > 0)?(parseInt(this.numLab.string)-1):0;\r\n        this.slide.progress = parseInt(this.numLab.string)/this.maxNum;\r\n        this.updateGain(parseInt(this.numLab.string));\r\n    },\r\n\r\n    updateGain(num)\r\n    {\r\n        var data = global.itemData.items[this.id];\r\n        var config = global.configConf['item'][data['item_id']];\r\n        this.gainLab.string = '✖'+ (num*parseInt(config['sale']));\r\n    },\r\n\r\n    onSubmitClick(target,data){\r\n        if(parseInt(this.numLab.string) == 0)\r\n            return;\r\n        \r\n        var param = {'id':this.id,'num':parseInt(this.numLab.string),'userId':global.userData.id,'token':global.userData.token};\r\n        global.HttpHelper.httpPost(global.urlConf.item_sale,param,(rsp)=>{\r\n            if(rsp == -1)\r\n            {\r\n                return;\r\n            }\r\n\r\n            if(rsp.code == 200)\r\n            {\r\n                global.clientAttrData.initClientAttrData(rsp.data.clientAttr);\r\n                global.itemData.update([rsp.data.item]);\r\n                cc.systemEvent.emit('updateItems',rsp.data.item);\r\n                cc.systemEvent.emit('showConfirmFrame',rsp.data.gold);\r\n                this.node.destroy();\r\n            }\r\n            else\r\n            {\r\n                return;\r\n            }\r\n        });\r\n\r\n    },\r\n\r\n    onCloseClick(target,data)\r\n    {\r\n        this.node.destroy();\r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n"]}